<?php
session_start();
require_once 'config.php';

// Kiểm tra quyền admin
if (!isset($_SESSION['role']) || $_SESSION['role'] !== 'admin') {
    header("Location: admin_login.html");
    exit;
}
?>
<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Quản trị hệ thống CGV</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .admin-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .welcome-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 30px;
        text-align: center;
      }
      .admin-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        transition: transform 0.3s ease;
      }
      .admin-card:hover {
        transform: translateY(-5px);
      }
      .feature-btn {
        width: 100%;
        padding: 15px;
        margin: 10px 0;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        text-decoration: none;
        display: inline-block;
        text-align: center;
        transition: all 0.3s ease;
      }
      .btn-movies {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        color: white;
      }
      .btn-showtimes {
        background: linear-gradient(45deg, #4834d4, #686de0);
        color: white;
      }
      .btn-tickets {
        background: linear-gradient(45deg, #00d2d3, #01a3a4);
        color: white;
      }
      .btn-users {
        background: linear-gradient(45deg, #feca57, #ff9ff3);
        color: white;
      }
      .btn-stats {
        background: linear-gradient(45deg, #48dbfb, #0abde3);
        color: white;
      }
      .btn-logout {
        background: linear-gradient(45deg, #ff3838, #ff4757);
        color: white;
      }
      .feature-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        color: white;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <div class="admin-container">
      <div class="welcome-card">
        <h1><i class="bi bi-shield-check"></i> Chào mừng đến Admin CGV</h1>
        <p class="lead">Hệ thống quản trị rạp chiếu phim</p>
        <hr>
        <p>Xin chào <strong><?php echo $_SESSION['fullname']; ?></strong>! Quản lý toàn bộ hoạt động của hệ thống CGV</p>
      </div>

      <div class="row">
        <!-- Quản lý Phim -->
        <div class="col-md-6 col-lg-4">
          <div class="admin-card">
            <h4><i class="bi bi-film"></i> Quản lý Phim</h4>
            <p>Thêm, sửa, xóa thông tin phim</p>
            <a href="admin_movies.php" class="feature-btn btn-movies">
              <i class="bi bi-plus-circle"></i> Quản lý Phim
            </a>
          </div>
        </div>

        <!-- Quản lý Suất Chiếu -->
        <div class="col-md-6 col-lg-4">
          <div class="admin-card">
            <h4><i class="bi bi-calendar-event"></i> Quản lý Suất Chiếu</h4>
            <p>Tạo lịch chiếu cho các phim</p>
            <a href="admin_showtimes.php" class="feature-btn btn-showtimes">
              <i class="bi bi-clock"></i> Quản lý Suất Chiếu
            </a>
          </div>
        </div>

        <!-- Quản lý Vé -->
        <div class="col-md-6 col-lg-4">
          <div class="admin-card">
            <h4><i class="bi bi-ticket-perforated"></i> Quản lý Vé</h4>
            <p>Xem danh sách vé đã đặt</p>
            <a href="admin_tickets.php" class="feature-btn btn-tickets">
              <i class="bi bi-list-check"></i> Xem Vé Đã Đặt
            </a>
          </div>
        </div>

        <!-- Quản lý Khách Hàng -->
        <div class="col-md-6 col-lg-4">
          <div class="admin-card">
            <h4><i class="bi bi-people"></i> Quản lý Khách Hàng</h4>
            <p>Xem thông tin khách hàng</p>
            <a href="admin_users.php" class="feature-btn btn-users">
              <i class="bi bi-person-lines-fill"></i> Danh Sách Khách Hàng
            </a>
          </div>
        </div>

        <!-- Thống Kê -->
        <div class="col-md-6 col-lg-4">
          <div class="admin-card">
            <h4><i class="bi bi-graph-up"></i> Thống Kê</h4>
            <p>Báo cáo doanh thu và số liệu</p>
            <a href="admin_stats.php" class="feature-btn btn-stats">
              <i class="bi bi-bar-chart"></i> Xem Thống Kê
            </a>
          </div>
        </div>

        <!-- Đăng Xuất -->
        <div class="col-md-6 col-lg-4">
          <div class="admin-card">
            <h4><i class="bi bi-box-arrow-right"></i> Đăng Xuất</h4>
            <p>Thoát khỏi hệ thống</p>
            <a href="logout.php" class="feature-btn btn-logout">
              <i class="bi bi-power"></i> Đăng Xuất
            </a>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<?php
session_start();
require_once 'config.php';

if ($_POST) {
    $username = $_POST['username'];
    $password = $_POST['password'];

    // Kiểm tra thông tin đăng nhập admin
    $stmt = $pdo->prepare("SELECT * FROM users WHERE username = ? AND role = 'admin'");
    $stmt->execute([$username]);
    $admin = $stmt->fetch(PDO::FETCH_ASSOC);

    if ($admin && password_verify($password, $admin['password'])) {
        // Đăng nhập thành công
        $_SESSION['user_id'] = $admin['id'];
        $_SESSION['username'] = $admin['username'];
        $_SESSION['fullname'] = $admin['fullname'];
        $_SESSION['role'] = $admin['role'];

        header("Location: admin.php");
        exit;
    } else {
        // Đăng nhập thất bại
        header("Location: admin_login.html?error=1");
        exit;
    }
}
?>
<?php
session_start();
require_once 'config.php';

// Kiểm tra quyền admin
if (!isset($_SESSION['role']) || $_SESSION['role'] !== 'admin') {
    header("Location: login.html");
    exit;
}

// Thêm phim mới
if ($_POST && isset($_POST['action']) && $_POST['action'] == 'add_movie') {
    $title = $_POST['title'];
    $genre = $_POST['genre'];
    $duration = $_POST['duration'];
    $release_date = $_POST['release_date'];
    $image = $_POST['image_url'];
    $description = $_POST['description'];
    $category_id = $_POST['category_id'];

    $stmt = $pdo->prepare("INSERT INTO movies (title, genre, duration, release_date, image, description, category_id) VALUES (?, ?, ?, ?, ?, ?, ?)");

    if ($stmt->execute([$title, $genre, $duration, $release_date, $image, $description, $category_id])) {
        echo "<script>alert('Thêm phim thành công!');</script>";
    }
}

// Lấy danh sách phim
$stmt = $pdo->prepare("SELECT m.*, c.name as category_name FROM movies m LEFT JOIN categories c ON m.category_id = c.id ORDER BY m.id DESC");
$stmt->execute();
$movies = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>

<!DOCTYPE html>
<html>

<head>
    <title>Quản lý phim - Admin CGV</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            padding: 20px;
        }

        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .table th {
            background-color: #f8f9fa;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="admin-card">
            <h1><i class="bi bi-film"></i> Quản lý Phim CGV</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="admin.php">Trang chủ Admin</a></li>
                    <li class="breadcrumb-item active">Quản lý Phim</li>
                </ol>
            </nav>
        </div>

        <div class="admin-card">
            <h3>Thêm phim mới</h3>
            <form method="POST" class="mb-4">
                <input type="hidden" name="action" value="add_movie">
                <div class="row">
                    <div class="col-md-4">
                        <input type="text" name="title" class="form-control" placeholder="Tên phim" required />
                    </div>
                    <div class="col-md-3">
                        <input type="text" name="genre" class="form-control" placeholder="Thể loại" />
                    </div>
                    <div class="col-md-3">
                        <input type="text" name="duration" class="form-control" placeholder="Thời lượng" />
                    </div>
                    <div class="col-md-2">
                        <input type="date" name="release_date" class="form-control" required />
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-6">
                        <input type="text" name="image_url" class="form-control" placeholder="Link ảnh poster" />
                    </div>
                    <div class="col-md-3">
                        <select name="category_id" class="form-control" required>
                            <option value="1">Hành Động</option>
                            <option value="2">Tình Cảm</option>
                            <option value="3">Hoạt Hình</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Thêm Phim
                        </button>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <textarea name="description" class="form-control" placeholder="Mô tả phim"></textarea>
                    </div>
                </div>
            </form>
        </div>

        <div class="admin-card">
            <h3>Danh sách phim</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên phim</th>
                            <th>Thể loại</th>
                            <th>Thời lượng</th>
                            <th>Ngày phát hành</th>
                            <th>Danh mục</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($movies as $movie): ?>
                        <tr>
                            <td><?php echo $movie['id']; ?></td>
                            <td><?php echo $movie['title']; ?></td>
                            <td><?php echo $movie['genre']; ?></td>
                            <td><?php echo $movie['duration']; ?></td>
                            <td><?php echo $movie['release_date']; ?></td>
                            <td><?php echo $movie['category_name']; ?></td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="admin-card text-center">
            <a href="admin.php" class="btn btn-secondary me-2">
                <i class="bi bi-house"></i> Về trang chủ Admin
            </a>
            <a href="admin_showtimes.php" class="btn btn-primary me-2">
                <i class="bi bi-calendar-event"></i> Quản lý suất chiếu
            </a>
            <a href="logout.php" class="btn btn-danger">
                <i class="bi bi-power"></i> Đăng xuất
            </a>
        </div>
    </div>
</body>

</html>
<?php
session_start();
require_once 'config.php';

// Kiểm tra quyền admin
if (!isset($_SESSION['role']) || $_SESSION['role'] !== 'admin') {
    header("Location: login.html");
    exit;
}

// Thêm suất chiếu mới
if ($_POST && isset($_POST['action']) && $_POST['action'] == 'add_showtime') {
    $movie_id = $_POST['movie_id'];
    $cinema_id = $_POST['cinema_id'];
    $show_date = $_POST['show_date'];
    $show_time = $_POST['show_time'];

    $stmt = $pdo->prepare("INSERT INTO showtimes (movie_id, cinema_id, show_date, show_time, total_seats, available_seats) VALUES (?, ?, ?, ?, 60, 60)");

    if ($stmt->execute([$movie_id, $cinema_id, $show_date, $show_time])) {
        echo "<script>alert('Thêm suất chiếu thành công!');</script>";
    }
}

// Lấy danh sách phim và rạp
$stmt = $pdo->prepare("SELECT id, title FROM movies ORDER BY title");
$stmt->execute();
$movies = $stmt->fetchAll(PDO::FETCH_ASSOC);

$stmt = $pdo->prepare("SELECT id, name FROM cinemas ORDER BY name");
$stmt->execute();
$cinemas = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Lấy danh sách suất chiếu
$stmt = $pdo->prepare("
    SELECT s.*, m.title as movie_title, c.name as cinema_name 
    FROM showtimes s 
    JOIN movies m ON s.movie_id = m.id 
    JOIN cinemas c ON s.cinema_id = c.id 
    WHERE s.show_date >= CURDATE()
    ORDER BY s.show_date, s.show_time
");
$stmt->execute();
$showtimes = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>

<!DOCTYPE html>
<html>

<head>
    <title>Quản lý suất chiếu - Admin CGV</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            padding: 20px;
        }

        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .table th {
            background-color: #f8f9fa;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="admin-card">
            <h1><i class="bi bi-calendar-event"></i> Quản lý Suất Chiếu CGV</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="admin.php">Trang chủ Admin</a></li>
                    <li class="breadcrumb-item active">Quản lý Suất Chiếu</li>
                </ol>
            </nav>
        </div>

        <div class="admin-card">
            <div class="row">
                <div class="col-md-6">
                    <h3>Thêm suất chiếu mới</h3>
                    <form method="POST" class="mb-4">
                        <input type="hidden" name="action" value="add_showtime">
                        <div class="mb-3">
                            <label>Phim:</label>
                            <select name="movie_id" class="form-control" required>
                                <option value="">Chọn phim</option>
                                <?php foreach ($movies as $movie): ?>
                                <option value="<?php echo $movie['id']; ?>"><?php echo $movie['title']; ?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label>Rạp:</label>
                            <select name="cinema_id" class="form-control" required>
                                <option value="">Chọn rạp</option>
                                <?php foreach ($cinemas as $cinema): ?>
                                <option value="<?php echo $cinema['id']; ?>"><?php echo $cinema['name']; ?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label>Ngày chiếu:</label>
                            <input type="date" name="show_date" class="form-control" required />
                        </div>
                        <div class="mb-3">
                            <label>Giờ chiếu:</label>
                            <input type="time" name="show_time" class="form-control" required />
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Thêm suất chiếu
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="admin-card">
            <h3>Danh sách suất chiếu</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Phim</th>
                            <th>Rạp</th>
                            <th>Ngày</th>
                            <th>Giờ</th>
                            <th>Ghế còn lại</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($showtimes as $showtime): ?>
                        <tr>
                            <td><?php echo $showtime['movie_title']; ?></td>
                            <td><?php echo $showtime['cinema_name']; ?></td>
                            <td><?php echo date('d/m/Y', strtotime($showtime['show_date'])); ?></td>
                            <td><?php echo date('H:i', strtotime($showtime['show_time'])); ?></td>
                            <td><?php echo $showtime['available_seats']; ?>/<?php echo $showtime['total_seats']; ?></td>
                            <td>
                                <?php if ($showtime['available_seats'] > 0): ?>
                                <span class="badge bg-success">Còn vé</span>
                                <?php else: ?>
                                <span class="badge bg-danger">Hết vé</span>
                                <?php endif; ?>
                            </td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="admin-card text-center">
            <a href="admin.php" class="btn btn-secondary me-2">
                <i class="bi bi-house"></i> Về trang chủ Admin
            </a>
            <a href="admin_movies.php" class="btn btn-primary me-2">
                <i class="bi bi-film"></i> Quản lý phim
            </a>
            <a href="logout.php" class="btn btn-danger">
                <i class="bi bi-power"></i> Đăng xuất
            </a>
        </div>
    </div>
</body>

</html>
<?php
session_start();
require_once 'config.php';

// Kiểm tra quyền admin
if (!isset($_SESSION['role']) || $_SESSION['role'] !== 'admin') {
    header("Location: login.html");
    exit;
}

// Thống kê tổng quan
$stats = [];

// Thống kê phim
$stmt = $pdo->prepare("
    SELECT m.title, COUNT(b.id) as bookings, SUM(b.quantity) as tickets_sold
    FROM movies m
    LEFT JOIN showtimes s ON m.id = s.movie_id
    LEFT JOIN bookings b ON s.id = b.showtime_id
    GROUP BY m.id
    ORDER BY tickets_sold DESC
    LIMIT 10
");
$stmt->execute();
$popular_movies = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Thống kê doanh thu theo tháng
$stmt = $pdo->prepare("
    SELECT DATE_FORMAT(booking_date, '%Y-%m') as month,
           COUNT(*) as total_bookings,
           SUM(quantity) as total_tickets,
           SUM(ticket_price * quantity) as revenue
    FROM bookings
    WHERE booking_date >= DATE_SUB(NOW(), INTERVAL 6 MONTH)
    GROUP BY month
    ORDER BY month DESC
");
$stmt->execute();
$monthly_stats = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Thống kê rạp
$stmt = $pdo->prepare("
    SELECT c.name, COUNT(b.id) as bookings, SUM(b.quantity) as tickets_sold
    FROM cinemas c
    LEFT JOIN showtimes s ON c.id = s.cinema_id
    LEFT JOIN bookings b ON s.id = b.showtime_id
    GROUP BY c.id
    ORDER BY tickets_sold DESC
");
$stmt->execute();
$cinema_stats = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Tổng quan hệ thống
$stmt = $pdo->prepare("SELECT COUNT(*) FROM movies");
$stmt->execute();
$total_movies = $stmt->fetchColumn();

$stmt = $pdo->prepare("SELECT COUNT(*) FROM users WHERE role = 'customer'");
$stmt->execute();
$total_customers = $stmt->fetchColumn();

$stmt = $pdo->prepare("SELECT COUNT(*) FROM bookings");
$stmt->execute();
$total_bookings = $stmt->fetchColumn();

$stmt = $pdo->prepare("SELECT SUM(ticket_price * quantity) FROM bookings");
$stmt->execute();
$total_revenue = $stmt->fetchColumn() ?: 0;
?>

<!DOCTYPE html>
<html>

<head>
    <title>Thống Kê - Admin CGV</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            padding: 20px;
        }

        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .stats-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
        }

        .stats-movies {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .stats-customers {
            background: linear-gradient(45deg, #4834d4, #686de0);
        }

        .stats-bookings {
            background: linear-gradient(45deg, #00d2d3, #01a3a4);
        }

        .stats-revenue {
            background: linear-gradient(45deg, #feca57, #ff9ff3);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="admin-card">
            <h1><i class="bi bi-graph-up"></i> Thống Kê Hệ Thống CGV</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="admin.php">Trang chủ Admin</a></li>
                    <li class="breadcrumb-item active">Thống Kê</li>
                </ol>
            </nav>
        </div>

        <!-- Thống kê tổng quan -->
        <div class="row">
            <div class="col-md-3">
                <div class="stats-card stats-movies">
                    <i class="bi bi-film" style="font-size: 2rem;"></i>
                    <h3><?php echo $total_movies; ?></h3>
                    <p>Tổng số phim</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card stats-customers">
                    <i class="bi bi-people" style="font-size: 2rem;"></i>
                    <h3><?php echo $total_customers; ?></h3>
                    <p>Khách hàng</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card stats-bookings">
                    <i class="bi bi-ticket-perforated" style="font-size: 2rem;"></i>
                    <h3><?php echo $total_bookings; ?></h3>
                    <p>Vé đã đặt</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card stats-revenue">
                    <i class="bi bi-currency-dollar" style="font-size: 2rem;"></i>
                    <h3><?php echo number_format($total_revenue/1000); ?>K</h3>
                    <p>Doanh thu (VNĐ)</p>
                </div>
            </div>
        </div>

        <!-- Top phim bán chạy -->
        <div class="admin-card">
            <h3><i class="bi bi-trophy"></i> Top Phim Bán Chạy</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Hạng</th>
                            <th>Tên Phim</th>
                            <th>Số lượt đặt</th>
                            <th>Vé đã bán</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($popular_movies as $index => $movie): ?>
                        <tr>
                            <td>
                                <?php if ($index < 3): ?>
                                <span class="badge bg-warning">#{<?php echo $index + 1; ?>}</span>
                                <?php else: ?>
                                #{<?php echo $index + 1; ?>}
                                <?php endif; ?>
                            </td>
                            <td><?php echo $movie['title']; ?></td>
                            <td><?php echo $movie['bookings'] ?: 0; ?> lượt</td>
                            <td><?php echo $movie['tickets_sold'] ?: 0; ?> vé</td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Thống kê doanh thu theo tháng -->
        <div class="admin-card">
            <h3><i class="bi bi-bar-chart"></i> Doanh Thu 6 Tháng Gần Đây</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Tháng</th>
                            <th>Số lượt đặt</th>
                            <th>Vé đã bán</th>
                            <th>Doanh thu</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($monthly_stats as $month): ?>
                        <tr>
                            <td><?php echo date('m/Y', strtotime($month['month'] . '-01')); ?></td>
                            <td><?php echo $month['total_bookings']; ?> lượt</td>
                            <td><?php echo $month['total_tickets']; ?> vé</td>
                            <td><?php echo number_format($month['revenue']); ?> VNĐ</td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Thống kê theo rạp -->
        <div class="admin-card">
            <h3><i class="bi bi-building"></i> Thống Kê Theo Rạp</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Tên Rạp</th>
                            <th>Số lượt đặt</th>
                            <th>Vé đã bán</th>
                            <th>Hiệu suất</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($cinema_stats as $cinema): ?>
                        <tr>
                            <td><?php echo $cinema['name']; ?></td>
                            <td><?php echo $cinema['bookings'] ?: 0; ?> lượt</td>
                            <td><?php echo $cinema['tickets_sold'] ?: 0; ?> vé</td>
                            <td>
                                <?php 
                                $performance = $cinema['tickets_sold'] ?: 0;
                                if ($performance > 50) {
                                    echo '<span class="badge bg-success">Cao</span>';
                                } elseif ($performance > 20) {
                                    echo '<span class="badge bg-warning">Trung bình</span>';
                                } else {
                                    echo '<span class="badge bg-danger">Thấp</span>';
                                }
                                ?>
                            </td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="admin-card text-center">
            <a href="admin.php" class="btn btn-secondary me-2">
                <i class="bi bi-house"></i> Về trang chủ Admin
            </a>
            <a href="admin_tickets.php" class="btn btn-info me-2">
                <i class="bi bi-ticket-perforated"></i> Quản lý vé
            </a>
            <a href="admin_users.php" class="btn btn-primary me-2">
                <i class="bi bi-people"></i> Quản lý khách hàng
            </a>
            <a href="logout.php" class="btn btn-danger">
                <i class="bi bi-power"></i> Đăng xuất
            </a>
        </div>
    </div>
</body>

</html>
<?php
session_start();
require_once 'config.php';

// Kiểm tra quyền admin
if (!isset($_SESSION['role']) || $_SESSION['role'] !== 'admin') {
    header("Location: login.html");
    exit;
}

// Lấy danh sách tất cả vé đã đặt
$stmt = $pdo->prepare("
    SELECT b.*, u.username, u.fullname, m.title as movie_title, 
           c.name as cinema_name, s.show_date, s.show_time,
           GROUP_CONCAT(bs.seat_number ORDER BY bs.seat_number) as seats
    FROM bookings b
    JOIN users u ON b.user_id = u.id
    JOIN showtimes s ON b.showtime_id = s.id
    JOIN movies m ON s.movie_id = m.id
    JOIN cinemas c ON s.cinema_id = c.id
    LEFT JOIN booked_seats bs ON b.id = bs.booking_id
    GROUP BY b.id
    ORDER BY b.booking_date DESC
");
$stmt->execute();
$bookings = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Thống kê tổng quan
$stmt = $pdo->prepare("SELECT COUNT(*) as total_bookings FROM bookings");
$stmt->execute();
$total_bookings = $stmt->fetchColumn();

$stmt = $pdo->prepare("SELECT COUNT(*) as total_seats FROM booked_seats");
$stmt->execute();
$total_seats = $stmt->fetchColumn();

$stmt = $pdo->prepare("SELECT SUM(ticket_price * quantity) as total_revenue FROM bookings");
$stmt->execute();
$total_revenue = $stmt->fetchColumn() ?: 0;
?>

<!DOCTYPE html>
<html>

<head>
    <title>Quản lý Vé - Admin CGV</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            padding: 20px;
        }

        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .stats-card {
            background: linear-gradient(45deg, #4834d4, #686de0);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .table th {
            background-color: #f8f9fa;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="admin-card">
            <h1><i class="bi bi-ticket-perforated"></i> Quản lý Vé Đã Đặt</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="admin.php">Trang chủ Admin</a></li>
                    <li class="breadcrumb-item active">Quản lý Vé</li>
                </ol>
            </nav>
        </div>

        <!-- Thống kê tổng quan -->
        <div class="row">
            <div class="col-md-4">
                <div class="stats-card">
                    <h3><?php echo $total_bookings; ?></h3>
                    <p>Tổng số lượt đặt vé</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <h3><?php echo $total_seats; ?></h3>
                    <p>Tổng số ghế đã đặt</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <h3><?php echo number_format($total_revenue); ?> VNĐ</h3>
                    <p>Tổng doanh thu</p>
                </div>
            </div>
        </div>

        <!-- Danh sách vé đã đặt -->
        <div class="admin-card">
            <h3>Danh sách vé đã đặt</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Khách hàng</th>
                            <th>Phim</th>
                            <th>Rạp</th>
                            <th>Ngày chiếu</th>
                            <th>Giờ chiếu</th>
                            <th>Ghế đã đặt</th>
                            <th>Số lượng</th>
                            <th>Tổng tiền</th>
                            <th>Ngày đặt</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($bookings as $booking): ?>
                        <tr>
                            <td><?php echo $booking['id']; ?></td>
                            <td>
                                <strong><?php echo $booking['fullname']; ?></strong><br>
                                <small>@<?php echo $booking['username']; ?></small>
                            </td>
                            <td><?php echo $booking['movie_title']; ?></td>
                            <td><?php echo $booking['cinema_name']; ?></td>
                            <td><?php echo date('d/m/Y', strtotime($booking['show_date'])); ?></td>
                            <td><?php echo date('H:i', strtotime($booking['show_time'])); ?></td>
                            <td>
                                <span class="badge bg-primary">
                                    <?php echo $booking['seats'] ?: 'N/A'; ?>
                                </span>
                            </td>
                            <td><?php echo $booking['quantity']; ?> vé</td>
                            <td><?php echo number_format($booking['ticket_price'] * $booking['quantity']); ?> VNĐ</td>
                            <td><?php echo date('d/m/Y H:i', strtotime($booking['booking_date'])); ?></td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="admin-card text-center">
            <a href="admin.php" class="btn btn-secondary me-2">
                <i class="bi bi-house"></i> Về trang chủ Admin
            </a>
            <a href="admin_stats.php" class="btn btn-info me-2">
                <i class="bi bi-graph-up"></i> Xem thống kê chi tiết
            </a>
            <a href="logout.php" class="btn btn-danger">
                <i class="bi bi-power"></i> Đăng xuất
            </a>
        </div>
    </div>
</body>

</html>
<?php
session_start();
require_once 'config.php';

// Kiểm tra quyền admin
if (!isset($_SESSION['role']) || $_SESSION['role'] !== 'admin') {
    header("Location: login.html");
    exit;
}

// Lấy danh sách người dùng
$stmt = $pdo->prepare("
    SELECT u.*, 
           COUNT(b.id) as total_bookings,
           SUM(b.quantity) as total_tickets,
           SUM(b.ticket_price * b.quantity) as total_spent
    FROM users u
    LEFT JOIN bookings b ON u.id = b.user_id
    WHERE u.role = 'customer'
    GROUP BY u.id
    ORDER BY u.registration_date DESC
");
$stmt->execute();
$users = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Thống kê người dùng
$stmt = $pdo->prepare("SELECT COUNT(*) as total_users FROM users WHERE role = 'customer'");
$stmt->execute();
$total_users = $stmt->fetchColumn();

$stmt = $pdo->prepare("SELECT COUNT(*) as active_users FROM users WHERE role = 'customer' AND id IN (SELECT DISTINCT user_id FROM bookings)");
$stmt->execute();
$active_users = $stmt->fetchColumn();
?>

<!DOCTYPE html>
<html>

<head>
    <title>Quản lý Khách Hàng - Admin CGV</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            padding: 20px;
        }

        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .stats-card {
            background: linear-gradient(45deg, #00d2d3, #01a3a4);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .table th {
            background-color: #f8f9fa;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="admin-card">
            <h1><i class="bi bi-people"></i> Quản lý Khách Hàng</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="admin.php">Trang chủ Admin</a></li>
                    <li class="breadcrumb-item active">Quản lý Khách Hàng</li>
                </ol>
            </nav>
        </div>

        <!-- Thống kê người dùng -->
        <div class="row">
            <div class="col-md-6">
                <div class="stats-card">
                    <h3><?php echo $total_users; ?></h3>
                    <p>Tổng số khách hàng</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="stats-card">
                    <h3><?php echo $active_users; ?></h3>
                    <p>Khách hàng đã đặt vé</p>
                </div>
            </div>
        </div>

        <!-- Danh sách khách hàng -->
        <div class="admin-card">
            <h3>Danh sách khách hàng</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Avatar</th>
                            <th>Thông tin</th>
                            <th>Email</th>
                            <th>Số điện thoại</th>
                            <th>Ngày đăng ký</th>
                            <th>Thống kê đặt vé</th>
                            <th>Tổng chi tiêu</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($users as $user): ?>
                        <tr>
                            <td>
                                <div class="user-avatar">
                                    <?php echo strtoupper(substr($user['fullname'], 0, 1)); ?>
                                </div>
                            </td>
                            <td>
                                <strong><?php echo $user['fullname']; ?></strong><br>
                                <small class="text-muted">@<?php echo $user['username']; ?></small>
                            </td>
                            <td><?php echo $user['email']; ?></td>
                            <td><?php echo $user['phone'] ?: 'Chưa cập nhật'; ?></td>
                            <td><?php echo date('d/m/Y', strtotime($user['registration_date'])); ?></td>
                            <td>
                                <span class="badge bg-primary"><?php echo $user['total_bookings']; ?> lượt</span><br>
                                <small><?php echo $user['total_tickets']; ?> vé</small>
                            </td>
                            <td>
                                <strong><?php echo number_format($user['total_spent'] ?: 0); ?> VNĐ</strong>
                            </td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="admin-card text-center">
            <a href="admin.php" class="btn btn-secondary me-2">
                <i class="bi bi-house"></i> Về trang chủ Admin
            </a>
            <a href="admin_tickets.php" class="btn btn-info me-2">
                <i class="bi bi-ticket-perforated"></i> Quản lý vé
            </a>
            <a href="logout.php" class="btn btn-danger">
                <i class="bi bi-power"></i> Đăng xuất
            </a>
        </div>
    </div>
</body>

</html>
<?php
$servername = "localhost:3308";
$username = "root";
$password = "";
$dbname = "cinema_booking";

try {
    $pdo = new PDO("mysql:host=$servername;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("Kết nối database thất bại: " . $e->getMessage());
}
<?php
require_once 'config.php';

// Tạo tài khoản admin mặc định
$admin_username = 'admin';
$admin_password = password_hash('admin123', PASSWORD_DEFAULT);
$admin_fullname = 'Administrator';
$admin_email = 'admin@cgv.com';

// Kiểm tra xem admin đã tồn tại chưa
$stmt = $pdo->prepare("SELECT id FROM users WHERE username = ? AND role = 'admin'");
$stmt->execute([$admin_username]);

if (!$stmt->fetch()) {
    // Tạo tài khoản admin
    $stmt = $pdo->prepare("INSERT INTO users (username, password, fullname, email, role, registration_date) VALUES (?, ?, ?, ?, 'admin', NOW())");
    
    if ($stmt->execute([$admin_username, $admin_password, $admin_fullname, $admin_email])) {
        echo "Tạo tài khoản admin thành công!<br>";
        echo "Tên đăng nhập: admin<br>";
        echo "Mật khẩu: admin123<br>";
        echo "<a href='admin_login.html'>Đăng nhập Admin</a>";
    } else {
        echo "Lỗi tạo tài khoản admin!";
    }
} else {
    echo "Tài khoản admin đã tồn tại!<br>";
    echo "Tên đăng nhập: admin<br>";
    echo "Mật khẩu: admin123<br>";
    echo "<a href='admin_login.html'>Đăng nhập Admin</a>";
}
?>
<?php
require_once 'config.php';

// Lấy movie_id từ URL (nếu có)
$selected_movie_id = isset($_GET['movie_id']) ? $_GET['movie_id'] : null;

// Lấy danh sách phim từ database
$stmt = $pdo->prepare("SELECT id, title FROM movies ORDER BY title");
$stmt->execute();
$movies = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Lấy danh sách rạp từ database  
$stmt = $pdo->prepare("SELECT id, name FROM cinemas ORDER BY name");
$stmt->execute();
$cinemas = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Lấy thông tin phim được chọn (nếu có)
$selected_movie = null;
if ($selected_movie_id) {
    $stmt = $pdo->prepare("SELECT * FROM movies WHERE id = ?");
    $stmt->execute([$selected_movie_id]);
    $selected_movie = $stmt->fetch(PDO::FETCH_ASSOC);
}

// Lấy suất chiếu có sẵn cho phim được chọn
$available_showtimes = [];
if ($selected_movie_id) {
    $stmt = $pdo->prepare("
        SELECT s.*, c.name as cinema_name 
        FROM showtimes s 
        JOIN cinemas c ON s.cinema_id = c.id 
        WHERE s.movie_id = ? AND s.show_date >= CURDATE() 
        ORDER BY s.show_date, s.show_time
    ");
    $stmt->execute([$selected_movie_id]);
    $available_showtimes = $stmt->fetchAll(PDO::FETCH_ASSOC);
}
?>
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CGV - Đặt Vé</title>

    <!-- CSS liên kết -->
    <link rel="stylesheet" href="ASST1.css" />

    <!-- Icon của trang -->
    <link rel="icon" href="./img/4.png" type="image/png" />

    <!-- Font Awesome để dùng icon dropdown -->
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>

<body>
    <div class="container">
        <!-- Thanh thông báo chạy -->
        <marquee behavior="scroll" direction="left">
            CGV Trần Duy Hưng 1-6-2025 Kỉ niệm 22 năm thành lập - tặng free bắp rang
            bơ và nước khi mua từ 2 vé trở lên
        </marquee>

        <!-- Phần đầu -->
        <header></header>

        <!-- Menu điều hướng -->
        <nav>
            <ul>
                <li><a href="./index.php">Trang chủ</a></li>
                <li class="dropdown">
                    <a href="#">Phim <i class="fas fa-chevron-down"></i></a>
                    <ul class="dropdown-content">
                        <li><a href="./movies.php?category=1">Phim Hành Động</a></li>
                        <li><a href="./movies.php?category=2">Phim Tình Cảm</a></li>
                        <li><a href="./movies.php?category=3">Phim Hoạt Hình</a></li>
                    </ul>
                </li>
                <li><a href="./list_cgv.php">Rạp CGV</a></li>
                <li><a href="./list_user.html">Thành viên</a></li>
                <li><a href="./ap.html">Tuyển dụng</a></li>
            </ul>
        </nav>

        <!-- Form đăng kí mua vé -->
        <div class="booking-container">
            <h3>Đặt Vé Xem Phim</h3>

            <?php if ($selected_movie): ?>
                <div class="selected-movie-info">
                    <h4>🎬 Phim đã chọn: <?php echo $selected_movie['title']; ?></h4>
                    <p><strong>Thể loại:</strong> <?php echo $selected_movie['genre']; ?></p>
                    <p><strong>Thời lượng:</strong> <?php echo $selected_movie['duration']; ?></p>
                </div>
            <?php endif; ?>

            <form action="datve_process.php" method="POST" id="bookingForm">
                <div>
                    <input
                        type="text"
                        name="customer_name"
                        placeholder="Tên Khách hàng"
                        required />
                </div>
                <br />
                <div>
                    <input
                        type="text"
                        name="phone"
                        placeholder="Số Điện Thoại"
                        required />
                </div>
                <br />

                <?php if ($selected_movie_id): ?>
                    <input type="hidden" name="movie_id" value="<?php echo $selected_movie_id; ?>" />
                <?php else: ?>
                    <div>
                        <select name="movie_id" required>
                            <option value="">Chọn phim</option>
                            <?php foreach ($movies as $movie): ?>
                                <option value="<?php echo $movie['id']; ?>"><?php echo $movie['title']; ?></option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    <br />
                <?php endif; ?>

                <!-- Chỉ hiển thị suất chiếu có sẵn -->
                <?php if (!empty($available_showtimes)): ?>
                    <div class="showtime-selection">
                        <h4>📅 Chọn suất chiếu có sẵn:</h4>
                        <div class="showtime-grid">
                            <?php
                            $current_date = '';
                            foreach ($available_showtimes as $showtime):
                                if ($current_date != $showtime['show_date']):
                                    $current_date = $showtime['show_date'];
                                    echo "<h5>" . date('d/m/Y - l', strtotime($showtime['show_date'])) . "</h5>";
                                endif;
                            ?>
                                <label class="showtime-option">
                                    <input type="radio" name="showtime_id" value="<?php echo $showtime['id']; ?>" required />
                                    <span>
                                        <strong><?php echo $showtime['cinema_name']; ?></strong><br>
                                        ⏰ <?php echo date('H:i', strtotime($showtime['show_time'])); ?>
                                        (Còn <?php echo $showtime['available_seats']; ?>/<?php echo $showtime['total_seats']; ?> ghế)
                                    </span>
                                </label>
                            <?php endforeach; ?>
                        </div>
                    </div>
                <?php else: ?>
                    <div class="no-showtime">
                        <h4>😔 Hiện tại chưa có suất chiếu nào cho phim này</h4>
                        <p>Vui lòng chọn phim khác hoặc quay lại sau.</p>
                        <button type="button" onclick="window.location.href='index.php'" class="btn-back">
                            🏠 Về trang chủ
                        </button>
                    </div>
                <?php endif; ?>

                <input type="hidden" name="seats" id="selectedSeats" />

                <div class="screen">MÀN HÌNH</div>

                <div class="seats">
                    <!-- Hàng A - Ghế thường -->
                    <div class="row" data-row="A">
                        <span class="row-label">A</span>
                        <div class="side">
                            <button type="button" class="seat">A1</button>
                            <button type="button" class="seat">A2</button>
                            <button type="button" class="seat">A3</button>
                            <button type="button" class="seat">A4</button>
                            <button type="button" class="seat">A5</button>
                            <button type="button" class="seat">A6</button>
                            <button type="button" class="seat">A7</button>
                        </div>
                        <div class="gap"></div>
                        <div class="side">
                            <button type="button" class="seat">A8</button>
                            <button type="button" class="seat">A9</button>
                            <button type="button" class="seat">A10</button>
                            <button type="button" class="seat">A11</button>
                            <button type="button" class="seat">A12</button>
                            <button type="button" class="seat">A13</button>
                            <button type="button" class="seat">A14</button>
                            <button type="button" class="seat">A15</button>
                        </div>
                    </div>

                    <!-- Hàng B - Ghế VIP -->
                    <div class="row" data-row="B">
                        <span class="row-label">B</span>
                        <div class="side">
                            <button type="button" class="seat vip">B1</button>
                            <button type="button" class="seat vip">B2</button>
                            <button type="button" class="seat vip">B3</button>
                            <button type="button" class="seat vip">B4</button>
                            <button type="button" class="seat vip">B5</button>
                            <button type="button" class="seat vip">B6</button>
                            <button type="button" class="seat vip">B7</button>
                        </div>
                        <div class="gap"></div>
                        <div class="side">
                            <button type="button" class="seat vip">B8</button>
                            <button type="button" class="seat vip">B9</button>
                            <button type="button" class="seat vip">B10</button>
                            <button type="button" class="seat vip">B11</button>
                            <button type="button" class="seat vip">B12</button>
                            <button type="button" class="seat vip">B13</button>
                            <button type="button" class="seat vip">B14</button>
                            <button type="button" class="seat vip">B15</button>
                        </div>
                    </div>

                    <!-- Hàng C - Ghế VIP -->
                    <div class="row" data-row="C">
                        <span class="row-label">C</span>
                        <div class="side">
                            <button type="button" class="seat vip">C1</button>
                            <button type="button" class="seat vip">C2</button>
                            <button type="button" class="seat vip">C3</button>
                            <button type="button" class="seat vip">C4</button>
                            <button type="button" class="seat vip">C5</button>
                            <button type="button" class="seat vip">C6</button>
                            <button type="button" class="seat vip">C7</button>
                        </div>
                        <div class="gap"></div>
                        <div class="side">
                            <button type="button" class="seat vip">C8</button>
                            <button type="button" class="seat vip">C9</button>
                            <button type="button" class="seat vip">C10</button>
                            <button type="button" class="seat vip">C11</button>
                            <button type="button" class="seat vip">C12</button>
                            <button type="button" class="seat vip">C13</button>
                            <button type="button" class="seat vip">C14</button>
                            <button type="button" class="seat vip">C15</button>
                        </div>
                    </div>

                    <!-- Hàng D - Ghế Sweetbox -->
                    <div class="row" data-row="D">
                        <span class="row-label">D</span>
                        <div class="side">
                            <button type="button" class="seat sweetbox">D1</button>
                            <button type="button" class="seat sweetbox">D2</button>
                            <button type="button" class="seat sweetbox">D3</button>
                            <button type="button" class="seat sweetbox">D4</button>
                            <button type="button" class="seat sweetbox">D5</button>
                            <button type="button" class="seat sweetbox">D6</button>
                            <button type="button" class="seat sweetbox">D7</button>
                        </div>
                        <div class="gap"></div>
                        <div class="side">
                            <button type="button" class="seat sweetbox">D8</button>
                            <button type="button" class="seat sweetbox">D9</button>
                            <button type="button" class="seat sweetbox">D10</button>
                            <button type="button" class="seat sweetbox">D11</button>
                            <button type="button" class="seat sweetbox">D12</button>
                            <button type="button" class="seat sweetbox">D13</button>
                            <button type="button" class="seat sweetbox">D14</button>
                            <button type="button" class="seat sweetbox">D15</button>
                        </div>
                    </div>
                </div>

                <div class="legend">
                    <span><span class="seat"></span> Ghế thường (60,000đ)</span>
                    <span><span class="seat vip"></span> Ghế VIP (80,000đ)</span>
                    <span><span class="seat sweetbox"></span> Ghế Sweetbox (120,000đ)</span>
                    <span><span class="seat booked"></span> Đã đặt</span>
                    <span><span class="seat selected"></span> Đang chọn</span>
                </div>

                <div class="exit">🚪 Cửa ra/vào</div>
            </form>
        </div>

        <!-- Hiển thị ghế đã chọn và tổng tiền -->
        <div class="booking-summary">
            <h4>Thông tin đặt vé:</h4>
            <p id="selectedSeatsDisplay">Ghế đã chọn: Chưa chọn</p>
            <p id="totalPrice">Tổng tiền: 0đ</p>
        </div>

        <!-- Khối chứa nút và thông báo -->
        <div class="center-wrapper">
            <button type="button" onclick="xacNhanDatVe()" class="confirm-button">
                Xác nhận đặt vé
            </button>
            <p id="thongbao" class="hidden success-message">
                Bạn đã đặt vé thành công! Hãy đến rạp để lấy vé và thanh toán.
            </p>
        </div>

        <!-- Footer -->
        <footer>
            <span>Chăm sóc khách hàng</span>
        </footer>
    </div>

    <script>
        // Biến lưu giá vé theo loại ghế
        const seatPrices = {
            'seat': 60000, // Ghế thường
            'seat vip': 80000, // Ghế VIP  
            'seat sweetbox': 120000 // Ghế Sweetbox
        };

        // Ghế đã đặt từ database (sẽ được load qua AJAX)
        let bookedSeats = [];

        // Load ghế đã đặt khi chọn suất chiếu
        function loadBookedSeats(showtimeId) {
            if (!showtimeId) return;

            fetch(`get_booked_seats.php?showtime_id=${showtimeId}`)
                .then(response => response.json())
                .then(data => {
                    bookedSeats = data;
                    updateSeatDisplay();
                })
                .catch(error => console.error('Error:', error));
        }

        // Cập nhật hiển thị ghế
        function updateSeatDisplay() {
            // Reset tất cả ghế
            document.querySelectorAll('.seat').forEach(seat => {
                seat.classList.remove('booked');
            });

            // Đánh dấu ghế đã đặt
            bookedSeats.forEach(seatNumber => {
                const seatElement = document.querySelector(`.seat:contains('${seatNumber}')`);
                if (seatElement) {
                    seatElement.classList.add('booked');
                }
            });

            // Tìm element theo text content
            document.querySelectorAll('.seat').forEach(seat => {
                if (bookedSeats.includes(seat.textContent.trim())) {
                    seat.classList.add('booked');
                }
            });
        }

        // Chọn ghế
        const seats = document.querySelectorAll('.seat');
        seats.forEach((seat) => {
            seat.addEventListener('click', () => {
                if (!seat.classList.contains('booked')) {
                    seat.classList.toggle('selected');
                    updateBookingSummary();
                }
            });
        });

        // Lắng nghe sự kiện chọn suất chiếu
        document.addEventListener('change', function(e) {
            if (e.target.name === 'showtime_id') {
                loadBookedSeats(e.target.value);
            }
        });

        // Cập nhật thông tin đặt vé
        function updateBookingSummary() {
            const selectedSeats = [];
            let totalPrice = 0;

            document.querySelectorAll('.seat.selected').forEach((seat) => {
                selectedSeats.push(seat.textContent);

                // Tính giá dựa trên loại ghế
                if (seat.classList.contains('sweetbox')) {
                    totalPrice += seatPrices['seat sweetbox'];
                } else if (seat.classList.contains('vip')) {
                    totalPrice += seatPrices['seat vip'];
                } else {
                    totalPrice += seatPrices['seat'];
                }
            });

            // Cập nhật hiển thị
            document.getElementById('selectedSeatsDisplay').textContent =
                'Ghế đã chọn: ' + (selectedSeats.length > 0 ? selectedSeats.join(', ') : 'Chưa chọn');
            document.getElementById('totalPrice').textContent =
                'Tổng tiền: ' + totalPrice.toLocaleString('vi-VN') + 'đ';
        }

        function xacNhanDatVe() {
            // Thu thập ghế đã chọn
            const selectedSeats = [];
            document.querySelectorAll('.seat.selected').forEach((seat) => {
                selectedSeats.push(seat.textContent);
            });

            if (selectedSeats.length === 0) {
                alert('Vui lòng chọn ít nhất 1 ghế!');
                return;
            }

            // Kiểm tra các field bắt buộc
            const customerName = document.querySelector('input[name="customer_name"]').value;
            const phone = document.querySelector('input[name="phone"]').value;
            const movieId = document.querySelector('input[name="movie_id"], select[name="movie_id"]').value;

            if (!customerName || !phone || !movieId) {
                alert('Vui lòng điền đầy đủ thông tin!');
                return;
            }

            // Kiểm tra suất chiếu đã được chọn
            const showtimeId = document.querySelector('input[name="showtime_id"]:checked');
            if (!showtimeId) {
                alert('Vui lòng chọn suất chiếu!');
                return;
            }

            // Cập nhật input hidden
            document.getElementById('selectedSeats').value = selectedSeats.join(',');

            // Submit form
            document.getElementById('bookingForm').submit();
        }

        // Load ghế đã đặt cho phim được chọn sẵn (nếu có)
        document.addEventListener('DOMContentLoaded', function() {
            const selectedShowtime = document.querySelector('input[name="showtime_id"]:checked');
            if (selectedShowtime) {
                loadBookedSeats(selectedShowtime.value);
            }
        });
    </script>
</body>

</html>
<?php
session_start();
require_once 'config.php';

if ($_POST) {
    $user_id = $_SESSION['user_id'] ?? null;
    $customer_name = $_POST['customer_name'];
    $phone = $_POST['phone'];
    $movie_id = $_POST['movie_id'];
    $seats = $_POST['seats'] ?? '';

    if (!$user_id) {
        echo "<script>alert('Vui lòng đăng nhập để đặt vé!'); window.location.href='login.html';</script>";
        exit;
    }

    if (empty($seats)) {
        echo "<script>alert('Vui lòng chọn ghế!'); window.location.href='datve.php?movie_id=$movie_id';</script>";
        exit;
    }

    try {
        $pdo->beginTransaction();

        // Khách hàng chỉ được chọn từ suất chiếu có sẵn
        if (!isset($_POST['showtime_id']) || empty($_POST['showtime_id'])) {
            throw new Exception("Vui lòng chọn suất chiếu!");
        }

        $showtime_id = $_POST['showtime_id'];

        // Kiểm tra suất chiếu có tồn tại và còn ghế không
        $stmt = $pdo->prepare("SELECT * FROM showtimes WHERE id = ? AND available_seats > 0");
        $stmt->execute([$showtime_id]);
        $showtime = $stmt->fetch();

        if (!$showtime) {
            throw new Exception("Suất chiếu không tồn tại hoặc đã hết ghế!");
        }

        // Kiểm tra ghế đã được đặt chưa
        $seatArray = explode(',', $seats);
        $seatArray = array_map('trim', $seatArray);

        if (count($seatArray) > $showtime['available_seats']) {
            throw new Exception("Số ghế bạn chọn vượt quá số ghế còn lại (" . $showtime['available_seats'] . " ghế)!");
        }

        foreach ($seatArray as $seat) {
            $stmt = $pdo->prepare("SELECT id FROM booked_seats WHERE showtime_id = ? AND seat_number = ?");
            $stmt->execute([$showtime_id, $seat]);
            if ($stmt->fetch()) {
                throw new Exception("Ghế $seat đã được đặt!");
            }
        }        // Tính giá vé theo loại ghế
        $total_price = 0;
        foreach ($seatArray as $seat) {
            $row = substr($seat, 0, 1); // Lấy hàng ghế (A, B, C, D)

            if ($row == 'A') {
                $total_price += 60000; // Ghế thường
            } elseif ($row == 'B' || $row == 'C') {
                $total_price += 80000; // Ghế VIP
            } elseif ($row == 'D') {
                $total_price += 120000; // Ghế Sweetbox
            }
        }

        // Lưu đặt vé
        $stmt = $pdo->prepare("INSERT INTO bookings (user_id, customer_name, phone, showtime_id, seats, total_price, status) VALUES (?, ?, ?, ?, ?, ?, 'confirmed')");
        $stmt->execute([$user_id, $customer_name, $phone, $showtime_id, $seats, $total_price]);
        $booking_id = $pdo->lastInsertId();

        // Lưu từng ghế đã đặt
        foreach ($seatArray as $seat) {
            $stmt = $pdo->prepare("INSERT INTO booked_seats (showtime_id, seat_number, booking_id) VALUES (?, ?, ?)");
            $stmt->execute([$showtime_id, $seat, $booking_id]);
        }

        // Cập nhật số ghế còn lại
        $stmt = $pdo->prepare("UPDATE showtimes SET available_seats = available_seats - ? WHERE id = ?");
        $stmt->execute([count($seatArray), $showtime_id]);

        $pdo->commit();

        echo "<script>alert('Đặt vé thành công! \\nTổng tiền: " . number_format($total_price) . "đ\\nKhách hàng: $customer_name\\nSĐT: $phone\\nGhế: $seats'); window.location.href='index.php';</script>";
    } catch (Exception $e) {
        $pdo->rollBack();
        echo "<script>alert('Lỗi: " . $e->getMessage() . "'); window.location.href='datve.php?movie_id=$movie_id';</script>";
    }
}
<?php
require_once 'config.php';

header('Content-Type: application/json');

$showtime_id = $_GET['showtime_id'] ?? null;

if (!$showtime_id) {
    echo json_encode([]);
    exit;
}

try {
    $stmt = $pdo->prepare("SELECT seat_number FROM booked_seats WHERE showtime_id = ?");
    $stmt->execute([$showtime_id]);
    $booked_seats = $stmt->fetchAll(PDO::FETCH_COLUMN);

    echo json_encode($booked_seats);
} catch (Exception $e) {
    echo json_encode([]);
}
<?php
require_once 'config.php';

$category_id = isset($_GET['category']) ? $_GET['category'] : null;

if ($category_id) {
    $stmt = $pdo->prepare("SELECT * FROM movies WHERE category_id = ? ORDER BY release_date DESC");
    $stmt->execute([$category_id]);
} else {
    $stmt = $pdo->prepare("SELECT * FROM movies ORDER BY release_date DESC");
    $stmt->execute();
}

$movies = $stmt->fetchAll(PDO::FETCH_ASSOC);

foreach ($movies as $movie) {
    echo '<div class="movie-card">';
    echo '<img src="' . $movie['image'] . '" alt="' . $movie['title'] . '" />';
    echo '<h3>' . $movie['title'] . '</h3>';
    echo '<p><strong>Thể loại:</strong> ' . $movie['genre'] . '</p>';
    echo '<p><strong>Thời lượng:</strong> ' . $movie['duration'] . '</p>';
    echo '<p><strong>Khởi chiếu:</strong> ' . date('d-m-Y', strtotime($movie['release_date'])) . '</p>';
    echo '<button onclick="window.location.href=\'datve.php?movie_id=' . $movie['id'] . '\'">Đặt vé</button>';
    echo '</div>';
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CGV-Trang chủ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="ASST1.css" />
    <link rel="icon" href="./img/4.png" />
</head>

<body>
    <div class="container">
        <marquee>CGV Trần Duy Hưng 1-6-2025 Kỉ niệm 22 năm thành lập tặng free bắp rang bơ và nước khi mua từ 2 vé trở
            lên</marquee>
        <header></header>
        <nav>
            <ul>
                <li><a href="./index.php">Trang chủ</a></li>
                <li class="dropdown">
                    <a href="#"> phim <i class="fas fa-chevron-down"></i> </a>
                    <ul class="dropdown-content">
                        <li><a href="./movies.php?category=1">Phim Hành Động</a></li>
                        <li><a href="./movies.php?category=2">Phim Tình Cảm</a></li>
                        <li><a href="./movies.php?category=3">Phim Hoạt Hình</a></li>
                    </ul>
                </li>
                <li><a href="./list_cgv.php">rap cgv</a></li>
                <li><a href="./list_user.html">thành viên</a></li>
                <li><a href="./ap.html">tuyển dụng</a></li>
            </ul>
        </nav>

        <aside>
            <span>
                <h4>đăng kí mua vé</h4>
                <div><input type="text" placeholder="điền thông tinn vào đây" /></div>
                <button onclick="window.location.href='datve.php'">đặt vé</button>
            </span>
            <span>
                <h3 id="t1">Giới thiệu CGV</h3>
                <p>
                    CJ CGV là một trong top 5 cụm rạp chiếu phim lớn nhất toàn cầu và là
                    nhà phát hành, cụm rạp chiếu phim lớn nhất Việt Nam.Mục tiêu của
                    chúng tôi là trở thành hình mẫu công ty điển hình đóng góp cho sự
                    phát triển không ngừng của ngành công nghiệp điện img Việt Nam.
                </p>
                <p>
                    CJ CGV đã tạo nên khái niệm độc đáo về việc chuyển đổi rạp chiếu
                    phim truyền thống thành tổ hợp văn hóa “Cultureplex”, nơi khán giả
                    không chỉ đến thưởng thức điện img đa dạng thông qua các công nghệ
                    tiên tiến như SCREENX, IMAX, STARIUM, 4DX, Dolby Atmos, cũng như
                    thưởng thức ẩm thực hoàn toàn mới và khác biệt trong khi trải nghiệm
                    dịch vụ chất lượng nhất tại CGV.
                </p>
                <p>
                    Thông qua những nỗ lực trong việc xây dựng chương trình Nhà biên
                    kịch tài năng, Dự án phim ngắn CJ, Lớp học làm phim TOTO, CGV
                    ArtHouse cùng việc tài trợ cho các hoạt động liên hoan phim lớn
                    trong nước như Liên hoan Phim quốc tế Hà Nội, Liên hoan Phim Việt
                    Nam, CJ CGV Việt Nam mong muốn sẽ khám phá và hỗ trợ phát triển cho
                    các nhà làm phim trẻ tài năng của Việt Nam.
                </p>
            </span>
        </aside>

        <article>
            <div class="main-content">
                <div class="movie-section">
                    <h1>PHIM ĐANG CHIẾU</h1>
                    <div class="movie-grid">
                        <?php include 'get_movies.php'; ?>
                    </div>
                </div>
            </div>
        </article>

        <footer>
            <span>chăm sóc khách hàng</span>
        </footer>
    </div>
</body>

</html>
<?php
require_once 'config.php';

// Lấy danh sách rạp từ database
$stmt = $pdo->prepare("SELECT * FROM cinemas ORDER BY name");
$stmt->execute();
$cinemas = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CGV</title>
    <link rel="stylesheet" href="ASST1.css" />
    <link rel="icon" href="./img/4.png" />
</head>

<body>
    <div class="container">
        <marquee>CGV Trần Duy Hưng 1-6-2025 Kỉ niệm 22 năm thành lập tặng free bắp rang bơ và nước khi mua từ 2 vé trở lên</marquee>
        <header></header>
        <nav>
            <ul>
                <li><a href="./index.php">trang chủ</a></li>
                <li class="dropdown">
                    <a href="#"> phim <i class="fas fa-chevron-down"></i> </a>
                    <ul class="dropdown-content">
                        <li><a href="./movies.php?category=1">Phim Hành Động</a></li>
                        <li><a href="./movies.php?category=2">Phim Tình Cảm</a></li>
                        <li><a href="./movies.php?category=3">Phim Hoạt Hình</a></li>
                    </ul>
                </li>
                <li><a href="./list_cgv.php">rap cgv</a></li>
                <li><a href="./list_user.html">thành viên</a></li>
                <li><a href="./ap.html">tuyển dụng</a></li>
            </ul>
        </nav>

        <article>
            <div class="container">
                <h1>DANH SÁCH RẠP CGV</h1>
                <div class="cinema-grid">
                    <?php foreach ($cinemas as $cinema): ?>
                        <div class="cinema-card">
                            <img src="<?php echo $cinema['image']; ?>" alt="<?php echo $cinema['name']; ?>" style="width: 200px; height: 150px; object-fit: cover;" />
                            <h3><?php echo $cinema['name']; ?></h3>
                            <p><?php echo $cinema['address']; ?></p>
                        </div>
                    <?php endforeach; ?>
                </div>
            </div>
        </article>
        <footer>
            <span>chăm sóc khách hàng</span>
        </footer>
    </div>
</body>

</html>
<?php
session_start();
require_once 'config.php';

if ($_POST) {
    $username = $_POST['username'];
    $password = $_POST['password'];

    $stmt = $pdo->prepare("SELECT id, username, email, password, role FROM users WHERE username = ?");
    $stmt->execute([$username]);
    $user = $stmt->fetch();

    if ($user && password_verify($password, $user['password'])) {
        $_SESSION['user_id'] = $user['id'];
        $_SESSION['username'] = $user['username'];
        $_SESSION['role'] = $user['role'];

        if ($user['role'] == 'admin') {
            header("Location: admin.php");
        } else {
            header("Location: ASST1.html");
        }
    } else {
        echo "<script>alert('Tên đăng nhập hoặc mật khẩu không đúng!'); window.location.href='login.html';</script>";
    }
}
<?php
session_start();
session_destroy();
header("Location: ASST1.html");
exit;
<?php
require_once 'config.php';

$category_id = $_GET['category'] ?? 1;
$category_names = [1 => 'HÀNH ĐỘNG', 2 => 'TÌNH CẢM', 3 => 'HOẠT HÌNH'];
$category_name = $category_names[$category_id] ?? 'PHIM';

$stmt = $pdo->prepare("SELECT * FROM movies WHERE category_id = ?");
$stmt->execute([$category_id]);
$movies = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>CGV-Phim <?php echo $category_name; ?></title>
    <link rel="stylesheet" href="ASST1.css" />
    <link rel="icon" href="./img/4.png" />
</head>

<body>
    <div class="container">
        <marquee>CGV Trần Duy Hưng 1-6-2025 Kỉ niệm 22 năm thành lập tặng free bắp rang bơ và nước khi mua từ 2 vé trở
            lên</marquee>
        <header></header>
        <nav>
            <ul>
                <li><a href="./index.php">trang chủ</a></li>
                <li class="dropdown">
                    <a href="#"> phim <i class="fas fa-chevron-down"></i> </a>
                    <ul class="dropdown-content">
                        <li><a href="./movies.php?category=1">Phim Hành Động</a></li>
                        <li><a href="./movies.php?category=2">Phim Tình Cảm</a></li>
                        <li><a href="./movies.php?category=3">Phim Hoạt Hình</a></li>
                    </ul>
                </li>
                <li><a href="./list_cgv.html">rap cgv</a></li>
                <li><a href="./list_user.html">thành viên</a></li>
                <li><a href="./ap.html">tuyển dụng</a></li>
            </ul>
        </nav>

        <aside>
            <!-- ...existing code... -->
        </aside>

        <article>
            <div class="main-content">
                <div class="movie-section">
                    <h1>PHIM <?php echo $category_name; ?></h1>
                    <div class="movie-grid">
                        <?php foreach ($movies as $movie): ?>
                        <div class="movie-card">
                            <img src="<?php echo $movie['image']; ?>" alt="<?php echo $movie['title']; ?>" />
                            <h3><?php echo $movie['title']; ?></h3>
                            <p><strong>Thể loại:</strong> <?php echo $movie['genre']; ?></p>
                            <p><strong>Thời lượng:</strong> <?php echo $movie['duration']; ?></p>
                            <p><strong>Khởi chiếu:</strong>
                                <?php echo date('d-m-Y', strtotime($movie['release_date'])); ?></p>
                            <button onclick="window.location.href='datve.php?movie_id=<?php echo $movie['id']; ?>'">Đặt
                                vé</button>
                        </div>
                        <?php endforeach; ?>
                    </div>
                </div>
            </div>
        </article>

        <footer>
            <span>chăm sóc khách hàng</span>
        </footer>
    </div>
</body>

</html>
<?php
require_once 'config.php';

if ($_POST) {
    $username = $_POST['username'];
    $email = $_POST['email'];
    $password = $_POST['password'];
    $confirm_password = $_POST['confirm_password'];

    // Kiểm tra mật khẩu
    if ($password !== $confirm_password) {
        echo "<script>alert('Mật khẩu không khớp!'); window.location.href='register.html';</script>";
        exit;
    }

    // Kiểm tra username đã tồn tại
    $stmt = $pdo->prepare("SELECT id FROM users WHERE username = ? OR email = ?");
    $stmt->execute([$username, $email]);

    if ($stmt->rowCount() > 0) {
        echo "<script>alert('Tên đăng nhập hoặc email đã tồn tại!'); window.location.href='register.html';</script>";
        exit;
    }

    // Thêm user mới
    $hashed_password = password_hash($password, PASSWORD_DEFAULT);
    $stmt = $pdo->prepare("INSERT INTO users (username, email, password, role) VALUES (?, ?, ?, 'customer')");

    if ($stmt->execute([$username, $email, $hashed_password])) {
        echo "<script>alert('Đăng ký thành công!'); window.location.href='login.html';</script>";
    } else {
        echo "<script>alert('Đăng ký thất bại!'); window.location.href='register.html';</script>";
    }
}
